# Vercel認証アクセスガイド

このガイドでは、Vercel認証で保護されたreX.tsシステムにアクセスする方法を説明します。

## Vercel認証について

Vercel認証は、Vercelプラットフォーム上にデプロイされたアプリケーションへのアクセスを制限するセキュリティ機能です。現在、reX.tsシステムのバックエンドAPIはこの認証で保護されています。

## 認証が必要な理由

Vercel認証は以下の理由でデプロイに適用されています：

1. 開発中のAPIやアプリケーションを無許可のアクセスから保護する
2. チームメンバーのみが特定のデプロイを閲覧できるようにする
3. プロジェクトの機密情報やAPIキーを保護する

## Vercel認証でのアクセス方法

### 前提条件

- Vercelアカウントを持っていること
- プロジェクトへのアクセス権があること（または付与されること）

### アクセス手順

1. **Vercelアカウントの作成・ログイン**
   - Vercelアカウントをお持ちでない場合は、[Vercel公式サイト](https://vercel.com/signup)でアカウントを作成してください
   - 既存のアカウントをお持ちの場合は、[ログインページ](https://vercel.com/login)からログインしてください

2. **保護されたデプロイへのアクセス**
   - 保護されたURLにアクセスすると、下記のようなVercel認証ページが表示されます
   
   ```
   ┌─────────────────────────────────────────────┐
   │                                             │
   │        Authenticating                       │
   │                                             │
   │  [スピナーアイコン]                         │
   │                                             │
   │  If you aren't automatically redirected,    │
   │  click here                                 │
   │                                             │
   │        Vercel Authentication                │
   │                                             │
   └─────────────────────────────────────────────┘
   ```
   
   - 「Login with Vercel」ボタンをクリックします（自動的にリダイレクトされる場合もあります）
   - Vercelアカウントの認証情報（メールアドレスとパスワード）を入力します
   
   ```
   ┌─────────────────────────────────────────────┐
   │                                             │
   │   Log in to Vercel                          │
   │                                             │
   │   ┌───────────────────────────────────┐     │
   │   │ your@email.com                    │     │
   │   └───────────────────────────────────┘     │
   │                                             │
   │   ┌───────────────────────────────────┐     │
   │   │ ********                          │     │
   │   └───────────────────────────────────┘     │
   │                                             │
   │          [Continue]                         │
   │                                             │
   └─────────────────────────────────────────────┘
   ```
   
   - 認証が成功すると、アクセス権があれば自動的に保護されたサイトにリダイレクトされます

3. **アクセス権がない場合**
   - アクセス権がない場合、下記のような「Request Access」（アクセスリクエスト）画面が表示されます
   
   ```
   ┌─────────────────────────────────────────────┐
   │                                             │
   │   You don't have access to this deployment  │
   │                                             │
   │   You can request access from the owner:    │
   │                                             │
   │          [Request Access]                   │
   │                                             │
   └─────────────────────────────────────────────┘
   ```
   
   - ボタンをクリックしてアクセスをリクエストすると、プロジェクト管理者に通知が送信されます
   - 管理者がリクエストを承認するまでお待ちください

4. **アクセス権の付与後**
   - アクセス権が付与されたら、再度保護されたURLにアクセスしてください
   - Vercelアカウントでログインすると、保護されたコンテンツが表示されます

## reX.tsシステムの特定のアクセス情報

現在、reX.tsシステムの本番環境は以下のURLで提供されています：

- バックエンドAPI: `https://backend-iqep5txo6-kinouecertify-gmailcoms-projects.vercel.app/api`

このAPIにアクセスするには、Vercel認証が必要です。以下の手順に従ってください：

1. 上記のURLにアクセスすると、Vercel認証画面が表示されます
2. Vercelアカウントでログインしてください
3. アクセス権がある場合は、自動的にAPIにアクセスできるようになります
4. アクセス権がない場合は、プロジェクト管理者にアクセスリクエストを送信してください

## 認証のトラブルシューティング

1. **認証ループが発生する場合**
   - ブラウザのCookieを削除して再試行してください
   - シークレットモード/プライベートブラウジングモードでアクセスしてみてください

2. **ログインしてもアクセスできない場合**
   - プロジェクト管理者があなたのアカウントにアクセス権を付与しているか確認してください
   - 異なるVercelアカウントでログインしていないか確認してください

3. **「Request Access」ボタンが表示されない場合**
   - プロジェクト設定でアクセスリクエストが無効になっている可能性があります
   - プロジェクト管理者に直接連絡してアクセス権の付与を依頼してください

## 代替アクセス方法

Vercel認証をバイパスする方法としては、以下のオプションがあります：

1. **ローカル環境での実行**
   - reX.tsのソースコードをローカルでクローンして実行する方法については、「reX.ts本番環境アクセスガイド.md」を参照してください

2. **自社サーバーへのデプロイ**
   - Vercel認証が不要な環境にプロジェクトを再デプロイする

## 管理者向け：Vercel認証の設定変更手順

プロジェクト管理者は以下の手順でVercel認証の設定を変更できます：

1. **ダッシュボードからの変更**
   - [Vercelダッシュボード](https://vercel.com/dashboard)にログインします
   - プロジェクトを選択します
   - 「Settings」タブを選択します
   - 「Deployment Protection」を選択します
   - 「Vercel Authentication」セクションで設定を変更します：
     - 認証を有効/無効にするトグルスイッチ
     - 保護する環境の選択（プレビュー、本番、またはすべて）
   - 「Save」ボタンをクリックして設定を保存します

2. **CLIからの変更**
   - Vercel CLIをインストールしていない場合は、以下のコマンドでインストールします：
   ```bash
   npm install -g vercel
   ```
   
   - Vercelにログインします：
   ```bash
   vercel login
   ```
   
   - プロジェクト設定を更新して認証を無効にします：
   ```bash
   vercel project update --protection disabled
   ```
   
   - または、認証を有効にするには：
   ```bash
   vercel project update --protection auth
   ```

3. **APIを使用した変更**
   - Vercel APIを使用して設定を変更する場合：
   ```bash
   curl -X PATCH "https://api.vercel.com/v9/projects/[プロジェクトID]" \
     -H "Authorization: Bearer [アクセストークン]" \
     -H "Content-Type: application/json" \
     -d '{"ssoProtection": null}'  # 無効化する場合
   ```
   
   - または、認証を有効にするには：
   ```bash
   curl -X PATCH "https://api.vercel.com/v9/projects/[プロジェクトID]" \
     -H "Authorization: Bearer [アクセストークン]" \
     -H "Content-Type: application/json" \
     -d '{"ssoProtection": {"deploymentType": "all"}}'  # すべての環境で有効化
   ```

## 補足情報

Vercel認証は、保護されたデプロイへのアクセスを制御する強力なセキュリティ層ですが、以下の点に注意してください：

- 認証トークンはブラウザのCookieとして保存され、特定のURLに対してのみ有効です
- 異なるURLやブラウザ間でトークンは共有されません
- 管理者はいつでもアクセス権を取り消すことができます

安全なアクセスのため、Vercelアカウントのパスワードは強力なものを使用し、可能であれば二要素認証を有効にすることをお勧めします。 