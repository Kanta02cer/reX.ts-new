# 実装レポート: 採用判断・スカウト文章生成システム

## 1. 実装概要

候補者のキャリア情報を分析し、採用条件と照らし合わせて採用可否を判断するシステムを実装しました。採用判断が「採用」となった候補者に対しては、パーソナライズされたスカウト文章を自動生成する機能も実装しています。

## 2. 技術スタック

- **バックエンド**: Node.js, Express.js
- **フロントエンド**: React, Next.js, Tailwind CSS
- **AI**: Google Gemini 1.5 Pro/Flash API
- **インフラ**: Vercel (本番環境)

## 3. 実装した機能

### 3.1 APIエンドポイント

1. **候補者分析・採用判断 API** (`/api/analyze-career`)
   - 候補者のキャリア情報と採用条件を入力として受け取り、詳細な分析と採用可否を判断
   - JSON形式で構造化された分析結果を返却

2. **スカウト文章生成 API** (`/api/generate-scout-message`)
   - 採用判断が「採用」となった候補者向けのスカウト文章を生成
   - 候補者の強みや経験を活かした個別化されたメッセージを作成

3. **統合 API** (`/api/analyze-and-scout`)
   - 上記2つのAPIを統合し、1回のリクエストで分析から採用判断、スカウト文章生成までを実行
   - 採用判断が「採用」の場合のみスカウト文章を生成

### 3.2 プロンプト設計

Gemini APIへのプロンプトは以下の原則に基づいて設計しました：

1. **分析プロンプト**
   - 候補者情報と採用条件を入力として受け取る
   - スキル分析、経験分析、総合評価、採用判断の4セクションで構成
   - 80点以上を「採用」、60-79点を「検討」、60点未満を「不採用」と判断

2. **スカウト文章生成プロンプト**
   - 候補者情報、採用条件、分析結果を入力として受け取る
   - 候補者の強みと採用条件との関連性を具体的に言及
   - 結びには面接への招待と次のステップを提案

### 3.3 本番環境設定

1. **CORS設定**
   - すべてのオリジンからのアクセスを許可
   - プリフライトリクエスト（OPTIONS）への対応

2. **環境変数**
   - Gemini API Keyの安全な管理
   - タイムアウト設定（60秒）

3. **CI/CD**
   - GitHub Actionsによる自動デプロイ
   - バックエンドとフロントエンドの個別デプロイ設定

## 4. 主要な実装フロー

1. **候補者分析と採用判断**
   ```
   候補者情報 + 採用条件 → Gemini API → JSON分析結果 → 採用可否判断
   ```

2. **合格者のスカウト文章生成**
   ```
   候補者情報 + 採用条件 + 分析結果 → Gemini API → パーソナライズされたスカウト文章
   ```

3. **統合フロー**
   ```
   候補者情報 + 採用条件 → 分析・採用判断 → 「採用」なら → スカウト文章生成
                                     → 「不採用」なら → 分析結果のみ返却
   ```

## 5. 実装上の工夫点

1. **JSON解析の堅牢性**
   - Gemini APIからの応答に余分なテキストが含まれる場合でも、正しくJSON部分を抽出
   - バックティックやマークダウン形式にも対応

2. **エラーハンドリング**
   - APIリクエストの失敗時の適切なエラーメッセージ
   - JSON解析エラー時のフォールバック処理

3. **パフォーマンス最適化**
   - リクエスト本文サイズ上限の拡大（10MB）
   - タイムアウト設定の最適化

4. **アクセス制御**
   - スカウト文章生成は採用判断が「採用」の場合のみ実行
   - 強制フラグ（force）でテスト時にはバイパス可能

## 6. 本番環境へのデプロイ

1. **Vercel設定**
   - `public: true` によるパブリックアクセスの有効化
   - カスタムヘッダーによるCORSの設定

2. **環境変数の設定**
   - `GOOGLE_API_KEY`: Gemini APIキー
   - `NODE_ENV`: 実行環境（production）
   - `API_TIMEOUT`: タイムアウト設定（60000ms）

3. **CI/CDパイプライン**
   - GitHub Actionsによる自動デプロイ
   - バックエンドとフロントエンドの連携設定

## 7. 今後の改善点

1. **パフォーマンス最適化**
   - APIレスポンスのキャッシュ導入
   - 大量データ処理時の非同期処理の改善

2. **機能拡張**
   - 複数の候補者を一括分析する機能
   - スカウト文章テンプレートのカスタマイズ

3. **セキュリティ強化**
   - API認証の導入
   - レート制限の実装

## 8. アクセス方法

- **バックエンドAPI**: https://backend-iqep5txo6-kinouecertify-gmailcoms-projects.vercel.app/api
- **APIドキュメント**: API_DOCUMENTATION.md
- **フロントエンド例**: frontend-example/analyze-scout-form.jsx 